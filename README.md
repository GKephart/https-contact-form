# ISSUING  SSL CERTS WITH DOCKER CERTBOT	


[original documentation](https://www.humankode.com/ssl/how-to-set-up-free-ssl-certificates-from-lets-encrypt-using-docker-and-nginx)
### Issuing the initial cert
1. add `/starter-code/starter-docker-compose.yml` to `/docker-compose.yml`
2. add `/starter-code/nginx.conf` to `/nginx.conf`
3. run the command below
```
sudo docker container run -it --rm \
-v /docker-volumes/pwp/etc/letsencrypt:/etc/letsencrypt \
-v /docker-volumes/pwp/etc/lib/letsencrypt:/var/lib/letsencrypt \
-v $(pwd)/public_html:/data/letsencrypt \
-v "/docker-volumes/pwp/var/log/:/var/log/letsencrypt" \
certbot/certbot \
certonly --webroot \
--register-unsafely-without-email --agree-tos \
--webroot-path=/data/letsencrypt \
--staging \
-d dont-blindly-copy-past.face-palm -d www.dont-blindly-copy-past.face-palm
```
* `-v /docker-volumes/pwp/etc/letsencrypt:/etc/letsencrypt \` \
	* Binds the `/etc/letsenscrypt` directory where the key is generated in the certbot container to the localhost's `docker-volumes/pwp/etc/letsencrypt`
* `-v /docker-volumes/pwp/etc/lib/letsencrypt:/var/lib/letsencrypt \`
	* binds `/var/lib/letsencrypt` in the certbot container to the localhost's `/docker-volumes/pwp/etc/lib/letsencrypt`
* `-v $(pwd)/public_html:/data/letsencrypt \`
 	* `$(pwd)` uses the current file location generated by pwd to run a command
 	*  binds `/data/letsencrypt` in the certbot container to the localhost's `/home/user/project/public_html` so that the ACME challenge can pass.
*  `-v "/docker-volumes/pwp/var/log/:/var/log/letsencrypt" \`
	* binds the `/var/log/letsencrypt" \` in the certbot container to the localhost's `/docker-volumes/pwp/var/log/` so that debugging logs from the certbot container can be preserved.
* `certbot/certbot` is the container that is going to be used.
* `certonly --webroot \` sets the webroot to `/`
* `--register-unsafely-without-email --agree-tos \` register unsafely for staging purposes and agree to the terms of service  
* `--webroot-path=/data/letsencrypt \` sets the webroot-path to `/data/letsencrypt` inside of the certbot container 
* `--staging \` issues the ssl certificate for staging purposes
* `-d dont-blindly-copy-past.face-palm`  specifies the domain/domains to verify for the ssl certificate 







4. If the command from step 3 is successful run these commands
	* `sudo rm -rf /docker-volumes/pwp`
	

1. make necessary directory changes 
* replace `*/public_html/php/mail-config.php` for `/php/mail-config.php` in the .gitignore file
* make sure that the paths to the SSL-certs in production.conf are correct and that  `return 301 https://uss-hopper.site$request_uri;` points to _our_ site.
* change the action attribute in the contact form to `php/index.php`
* make sure your index.html is an html file

2. cd into the the project on digital ocean
3. run `mkdir dh-param`
4. run `sudo openssl dhparam -out dh-param/dhparam-2048.pem 2048` 
5. run `docker-compose up -d`
6. read the rest of the article to learn about renewing TLS certs

